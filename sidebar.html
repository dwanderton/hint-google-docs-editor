<!DOCTYPE html>
<html>
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-154880962-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-154880962-2');
    </script>

    <base target="_top">


    <!-- Libs CSS -->
    <link rel="stylesheet" href="https://hintwriting.com/assets/fonts/Feather/feather.css">
    <link rel="stylesheet" href="https://hintwriting.com/assets/libs/flickity/dist/flickity.min.css">
    <link rel="stylesheet" href="https://hintwriting.com/assets/libs/flickity-fade/flickity-fade.css">
    <link rel="stylesheet" href="https://hintwriting.com/assets/libs/aos/dist/aos.css">
    <link rel="stylesheet" href="https://hintwriting.com/assets/libs/jarallax/dist/jarallax.css">
    <link rel="stylesheet" href="https://hintwriting.com/assets/libs/highlightjs/styles/vs2015.css">
    <link rel="stylesheet" href="https://hintwriting.com/assets/libs/@fancyapps/fancybox/dist/jquery.fancybox.min.css">

    <!-- Theme CSS -->
    <link rel="stylesheet" href="https://hintwriting.com/assets/css/theme.min.css">
    <link rel="stylesheet" href="https://hintwriting.com/assets/css/custom.css">

    <style>
    /*
    Footer as the absolute footer
    */
    footer {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: .2rem;            /* Footer height */
    }

    /*
    * misc styles
    */
    #error-bay {
      display:none;
    }

    .pointer {
      cursor: pointer;
    }
    .flag-hint:hover {
      color: #df4759!important;
    }

    .btn-category {
      padding-top: 3px;
      padding-bottom: 3px
    }

    /*
    * typing styles
    */

    /* Cursor Styling */

    .cursor::after {
      content:'';
      display:inline-block;
      margin-left:3px;
      background-color:black;
      animation-name:blink;
      animation-duration:0.5s;
      animation-iteration-count: infinite;
    }
    h5.cursor::after {
      height:13px;
      width:6px;
    }
    p.cursor::after {
      height:13px;
      width:6px;
    }

    @keyframes blink {
      0% {
        opacity:1;
      }
      49% {
        opacity:1;
      }
      50% {
        opacity:0;
      }
      100% {
        opacity:0;
      }
    }
    </style>

  </head>
  <body>
  <div class="container" style="padding-top: 5%; padding-bottom: 5%;">
    <div id="shareAlert" class="alert alert-success" role="alert" style="position:absolute;display:none;">
      share link is in your clipboard!
    </div>
    <a class="navbar-brand" href="https://hintwriting.com" target="_blank">
      <img src="https://hintwriting.com/assets/img/brand.png" class="navbar-brand-img" alt="hint logo">
    </a>

    <i class="fas fa-share-alt share-hint text-primary" style="position: absolute; right: 20px; top: 30px; font-size: 1.2em; cursor:pointer;"></i>
    <br/><br/>
    <form>
      <div id="category-questions">
        <p class="lead">What type of writing will you be doing today?</p>
        <button type="button" class="btn btn-light btn-lg btn-block btn-category" data-value="marketing">marketing</button>
        <button type="button" class="btn btn-light btn-lg btn-block btn-category" data-value="business">business writing</button>
        <button type="button" class="btn btn-light btn-lg btn-block btn-category" data-value="legal">legal</button>
        <button type="button" class="btn btn-light btn-lg btn-block btn-category" data-value="school">school</button>
        <button type="button" class="btn btn-light btn-lg btn-block btn-category" data-value="creative">creative writing</button>
        <button type="button" class="btn btn-light btn-lg btn-block btn-category" data-value="journalism">journalism</button>
        <button type="button" class="btn btn-light btn-lg btn-block btn-category" data-value="other">other</button>
        <button type="button" class="btn btn-light btn-lg btn-block btn-category" data-value="noidea">no idea</button>
      </div>

      <div id="loading" class="block" style="display:none;">
        <div id="bm"></div>
      </div>
      <div class="form-group">
        <div class="output" id="output" style="display:none">
          <p class="cursor" id="output-paragraph" contenteditable></p>
        </div>
      </div>
      <div class="block text-center" id="button-bar-0" style="display:none;">
        <button class="btn btn-primary shadow lift mr-1 run-hint">
          get a hint
        </button>
      </div>
      <div class="block text-center" id="button-bar-1" style="display:none;">
        <button class="btn btn-success shadow lift mr-1" id="insert-text">
          insert
        </button>
        <button class="btn btn-outline-primary shadow lift mr-1 run-hint re-hint">
          <i class="fas fa-redo"></i> re-hint
        </button>
        <br><br>
        <button class="btn btn-outline-danger shadow lift mr-1" id="reject-text">
          <i class="fas fa-times"></i> reject
        </button>
        <!-- <p class="text-muted p-3">
          <a class="flag-hint pointer"><i class="far fa-flag"></i> flag this hint</a>
          <!-- typos and grammar; incomplete; offensive/inappropriate - severe; offensive/inappropriate - mild; inaccurate -->
          <!--
        </p> -->
      </div>
      <br/><br/>
      <div id="error-bay">
      </div>
    </form>
    <!--
    <footer>
      <div class="container">
        <small class="text-muted" onclick="copyShareHint()" style="cursor:pointer;">click <strong>here</strong> to share hint!</small>
      </div>
    </footer>
  -->
  </div>

  <!-- end of page -->

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://kit.fontawesome.com/c5ae9bac41.js" crossorigin="anonymous"></script>
  <script src="https://hintwriting.com/assets/js/lottie.js"></script>
  <script>
    /* robot animation */
    var animation = bodymovin.loadAnimation({
      container: document.getElementById('bm'),
      renderer: 'svg',
      loop: true,
      autoplay: false,
      path: 'https://hintwriting.com/assets/img/robot-animation/data.json'
    });

    </script>


    <script>
    /**
    * typing https://codepen.io/daviddcarr/pen/XVyQMM
    **/
    // values to keep track of the number of letters typed, which quote to use. etc. Don't change these values.
    var i = 0,
        a = 0,
        isBackspacing = false,
        isParagraph = false;

    // Speed (in milliseconds) of typing.
    var speedForward = 20, //Typing Speed
        speedWait = 1000, // Wait between typing and backspacing
        speedBetweenLines = 800, //Wait between end of sentences
        speedBackspace = 5; //Backspace Speed


    function typeWriter( id , ar , isBackspacing=false ) {
      var element = $( "#" + id ),
          aString = ar[ a ],
          eParagraph = element.children( "p" ); //Subheader element

      if ( !eParagraph.hasClass( "cursor" ) )
      {

        eParagraph.addClass( "cursor" );

      }

      // Determine if animation should be typing or backspacing
      if ( !isBackspacing )
      {

        // If full string hasn't yet been typed out, continue typing
        if ( i < aString.length )
        {

          if ( aString.charAt(i) == "." || aString.charAt(i) == "?" || aString.charAt(i) == "," )
          {

            eParagraph.text( eParagraph.text() + aString.charAt(i) );
            i++;
            setTimeout( function(){ typeWriter(id, ar); }, speedBetweenLines );

          }
          else
          {

            eParagraph.text( eParagraph.text() + aString.charAt(i) );
            i++;
            setTimeout( function(){ typeWriter(id, ar); }, speedForward );

          }

        // If full string has been typed
        }
        else if ( i == aString.length )
        {

          // full string typed.
          console.info("finsihed typing");
          eParagraph.removeClass("cursor");
          lottie.pause();
          $('#loading' ).hide( 'fast' , function()
          {
            $( '#button-bar-1' ).slideDown( 600 , function(){$( '#output-paragraph' ).focus();});
            $( '#loading' ).animate({ width: '+=80%' , height: '+=80%' }, 0 );
          });

          // TODO show insert and rehint button.

          // isBackspacing = true;
          // setTimeout(function(){ typeWriter(id, ar); }, speedWait);

        }

      // If backspacing is enabled
      } else {

        // If still has text, continue backspacing
        if (eParagraph.text().length > 0) {
          eParagraph.text(eParagraph.text().substring(0, eParagraph.text().length - 1));
          setTimeout(function(){ typeWriter(id, ar, true); }, speedBackspace);

        // If no text, complete.
        } else {

          i = 0;
          // a = (a + 1) % ar.length; //Moves to next position in array, always looping back to 0
          console.info("finsihed deleting");
          eParagraph.removeClass("cursor");
          $('#loading').show("fast");

          // setTimeout(function(){ typeWriter(id, ar); }, 50);

        }
      }
    }
    </script>

    <script>


      $(function() {
        $('.btn-category').click(catqReport)
        $('.run-hint').click(hintText);
        $('.flag-hint').click(flaghint);
        $('#insert-text').click(insertText);
        $('#reject-text').click(rejectText);
        $('.share-hint').click(copyShareHint);
        var currentHint = "";
      });

      /**
      *  Runs a server-side function to set user category
      */
      function catqReport (event){
        $( '.btn-category' ).attr( "disabled" , true )
        reportCategory = $( event.target ).data( 'value' );
        $( '#category-questions' ).hide( 'fast' );
        google.script.run
            .withSuccessHandler(
            function( response , element )
            {
                $( '#loading' ).slideDown( 600 , function() { $( '#button-bar-0' ).slideDown( 300 ); });
            })
            .withFailureHandler(
              function( msg , element ) {
                logError( msg, true );
                $( '#loading' ).slideDown( 600 , function() { $( '#button-bar-0' ).slideDown( 300 ); });
              })
             .withUserObject( this )
             .submitCatergory( reportCategory );
      }

      /**
       * Runs a server-side function to fetch text based on user inputs
       * the sidebar UI with the resulting text.
       */
      function hintText ( event ) {
        if ( $(event.target).hasClass('re-hint') )
        {
          gtag('event', 're-hint', { 'event_category': 'engagement', 'event_label': currentHint});
        } else {
          gtag( 'event' , 'hint', { 'event_category' : 'engagement', method : 'hint-sidebar' });
        }
        $('#output').hide();
        hideButtons();
        hideError();
        lottie.play();
        typeWriter("output", [], true);
        console.log('entering hintText');
        this.disabled = true;
        $('#error').remove();
        var originalText = $('input[name=origin]').val();
        google.script.run
            .withSuccessHandler(
              function( response , element )
              {
                currentHint = response.suggestion;
                if(response.nohint)
                {
                  $('#output').html("<p>" + response.suggestion + "</p>").show(500);
                  $('#loading' ).hide( 'fast' , function()
                  {
                    lottie.pause();
                    setTimeout(function(){ rejectText(true); }, 5000);

                  });


                  element.disabled = false;
                }
                else
                {
                  $('#loading').animate({ width: '-=80%', height: '-=80%' }, 500, function(){
                    $('#output').show(0).attr("contenteditable", "true");
                    typeWriter("output", [response.suggestion]);
                  });

                  element.disabled = false;
                }
              })
            .withFailureHandler(
              function(msg, element) {
                logError(msg, true);
                lottie.pause();
                element.disabled = false;
                displayError();
                $('#button-bar-0').slideDown(600);
              })
             .withUserObject(this)
             .getTextandGiveHint();
        console.log('exiting hintText');
      }

      /**
       * Runs a server-side function to insert the fetched text into the document
       * at the user's cursor or selection.
       */
      function insertText() {
        hideButtons();
        hideError();
        gtag('event', 'insert', { 'event_category' : 'engagement', method : 'hint-sidebar'});
        console.log('entering insertText');
        //var originalText = $('input[name=origin]').val();
        this.disabled = true;
        typeWriter("output", [], true);
          google.script.run
            .withSuccessHandler(
              function(returnSuccess, element) {
                element.disabled = false;
                //$('#textSuggestion').val(returnSuccess.suggestion);
                //$('input[name=originalText]').val(returnSuccess.suggestion);

                // factor out into function
                $('#loading').show("fast");
                $('#button-bar-0').slideDown(600);
              })
            .withFailureHandler(
              function(msg, element) {
                logError(msg, true);
                displayError();
                element.disabled = false;

                // factor out into function
                $('#loading').show("fast");
                $('#button-bar-0').slideDown(600);
              })
            .withUserObject(this)
            .insertText($('#output').text())
            .getTextandGiveHint();

            console.log('exiting insertText');
      }

      function rejectText(nohint) {
        hideButtons();
        hideError();
        if(typeof nohint === 'undefined'){ gtag('event', 'reject', { 'event_category' : 'engagement', method : 'hint-sidebar'}); }
        console.log('entering rejectText');
        //var originalText = $('input[name=origin]').val();
        this.disabled = true;
        typeWriter("output", [], true);
        $('#loading').show("fast");
        $('#button-bar-0').slideDown(600);
        console.log('exiting rejectText');
      }

      function flaghint (issue=0) {
        gtag('event', 'flag-hint', { 'event_category': 'engagement', 'event_label': currentHint, 'event_value': issue});
      }




      function logError(msg, fatal) {
        console.error(msg);
        gtag('event', 'exception', { 'description': msg, 'fatal' : fatal});
      }
      function displayError(){
        var div = $('<div class="alert alert-warning" role="alert"><strong>Oops!</strong><br/>Seems like something didn\'t quite work out. First try resarting Hint, and then if something still doesn\'t work email <strong>hello@hintwriting.com</strong> for support!</div>');
        $('#error-bay').html(div);
        $('#error-bay').slideDown("slow");
      }
      function hideError(){
        $('#error-bay').slideUp("fast");
      }
      function hideButtons(){
        $('form [id^="button-bar-"]').slideUp("fast");
      }

      function copyShareHint() {
       $('#shareAlert').fadeIn();
       // Create temp element off-screen to hold text.
       var tempElem = $('<textarea style="position: absolute; top: -8888px; left: -8888px">');
       $("body").append(tempElem);
       tempElem.val("try out hint to supercharge your writing: http://bit.ly/givehint-gdocs").select();
       document.execCommand("copy");
       tempElem.remove();
       setTimeout(function(){ $('#shareAlert').fadeOut(); },2000);
      }

    </script>
  </body>
</html>
